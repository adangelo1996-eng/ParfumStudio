<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Parfum Studio</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Courier+Prime:wght@400;700&display=swap');

        *{margin:0;padding:0;box-sizing:border-box;}

        :root{
            --black:#000;
            --white:#fff;
            --red:#ff0000;
            --gray-100:#fafafa;
            --gray-200:#f0f0f0;
            --gray-300:#e0e0e0;
            --gray-500:#666;
            --gray-700:#333;
            --blue:#3b82f6;
            --amber:#f59e0b;
            --purple:#7c3aed;
            --font:'Courier Prime','Courier New',monospace;
        }

        body{font-family:var(--font);background:var(--white);color:var(--black);line-height:1.6;-webkit-font-smoothing:antialiased;}

        /* ‚îÄ‚îÄ‚îÄ LANDING ‚îÄ‚îÄ‚îÄ */
        #landing{
            display:flex;flex-direction:column;align-items:center;
            justify-content:center;min-height:100vh;text-align:center;
            padding:2rem;transition:opacity .5s ease;
        }
        #landing.out{opacity:0;pointer-events:none;}

        .dot{
            width:72px;height:72px;background:var(--red);border-radius:50%;
            margin-bottom:2.5rem;animation:pulse 2s ease-in-out infinite;
        }
        @keyframes pulse{0%,100%{transform:scale(1)}50%{transform:scale(1.06)}}
        .dot.boom{animation:boom .7s ease-out forwards;}
        @keyframes boom{0%{transform:scale(1)}60%{transform:scale(18);opacity:.6}100%{transform:scale(1);opacity:0}}

        #landing h1{font-size:3.5rem;font-weight:400;letter-spacing:.02em;margin-bottom:.5rem;}
        .land-sub{font-size:1.1rem;color:var(--gray-500);margin-bottom:2.5rem;}

        /* ‚îÄ‚îÄ‚îÄ BUTTONS ‚îÄ‚îÄ‚îÄ */
        .btn{
            padding:.9rem 2.5rem;background:var(--black);color:var(--white);
            border:none;border-radius:50px;font-size:1rem;font-weight:500;
            cursor:pointer;transition:all .3s ease;letter-spacing:.04em;
            font-family:var(--font);
        }
        .btn:hover{background:var(--red);transform:translateY(-2px);}
        .btn-outline{
            background:var(--white);color:var(--black);
            border:1.5px solid var(--black);
        }
        .btn-outline:hover{background:var(--black);color:var(--white);}
        .btn-sm{padding:.6rem 1.5rem;font-size:.9rem;}
        .btn:disabled{opacity:.35;pointer-events:none;}

        /* ‚îÄ‚îÄ‚îÄ HEADER ‚îÄ‚îÄ‚îÄ */
        #header{
            position:fixed;top:0;left:0;right:0;
            background:rgba(255,255,255,.95);backdrop-filter:blur(10px);
            border-bottom:1px solid var(--gray-300);z-index:999;
            padding:1.2rem 2rem;display:none;
        }
        .hrow{max-width:1200px;margin:0 auto;display:flex;justify-content:space-between;align-items:center;}
        .logo{display:flex;align-items:center;gap:.5rem;font-size:1.3rem;font-weight:500;cursor:pointer;transition:opacity .3s;}
        .logo:hover{opacity:.6;}
        .logo-dot{width:10px;height:10px;background:var(--red);border-radius:50%;}

        /* ‚îÄ‚îÄ‚îÄ APP ‚îÄ‚îÄ‚îÄ */
        #app{display:none;max-width:1200px;margin:0 auto;padding:2rem;padding-top:100px;}
        #app.show{display:block;animation:fadeUp .5s ease;}
        @keyframes fadeUp{from{opacity:0;transform:translateY(16px)}to{opacity:1;transform:translateY(0)}}

        /* ‚îÄ‚îÄ‚îÄ PROGRESS ‚îÄ‚îÄ‚îÄ */
        .progress-wrap{
            background:var(--gray-100);border:1px solid var(--gray-300);
            border-radius:12px;padding:1.5rem 2rem;margin-bottom:2rem;
        }
        .progress-steps{display:flex;position:relative;margin-bottom:.5rem;}
        .progress-steps::before{
            content:'';position:absolute;top:19px;left:0;right:0;
            height:2px;background:var(--gray-300);z-index:0;
        }
        .prog-line{
            position:absolute;top:19px;left:0;height:2px;
            background:var(--red);z-index:1;transition:width .4s ease;
        }
        .ps{display:flex;flex-direction:column;align-items:center;flex:1;position:relative;z-index:2;}
        .ps-circle{
            width:38px;height:38px;border-radius:50%;background:var(--white);
            border:2px solid var(--gray-300);display:flex;align-items:center;
            justify-content:center;font-weight:600;margin-bottom:.3rem;transition:all .3s;
        }
        .ps.active .ps-circle{background:var(--black);border-color:var(--black);color:var(--white);}
        .ps.done .ps-circle{background:var(--red);border-color:var(--red);color:var(--white);}
        .ps-label{font-size:.78rem;color:var(--gray-500);text-align:center;}
        .ps.active .ps-label{color:var(--black);font-weight:600;}

        /* ‚îÄ‚îÄ‚îÄ STEP CONTENT ‚îÄ‚îÄ‚îÄ */
        .step{display:none;}
        .step.on{display:block;animation:fadeUp .35s ease;}

        .step-h{font-size:2.2rem;font-weight:400;margin-bottom:.6rem;letter-spacing:.01em;}
        .step-sub{font-size:1.05rem;color:var(--gray-500);margin-bottom:2rem;}

        /* ‚îÄ‚îÄ‚îÄ OPTION CARDS ‚îÄ‚îÄ‚îÄ */
        .cards-grid{
            display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));
            gap:1.2rem;margin-bottom:2rem;
        }
        .card{
            background:var(--gray-100);border:2px solid var(--gray-300);
            border-radius:12px;padding:1.6rem 1.2rem;cursor:pointer;
            transition:all .3s;text-align:center;position:relative;
        }
        .card:hover{border-color:var(--black);transform:translateY(-3px);}
        .card.sel{background:var(--black);color:var(--white);border-color:var(--black);box-shadow:0 6px 20px rgba(0,0,0,.15);}
        .card.sel::after{
            content:'‚úì';position:absolute;top:10px;right:10px;
            width:22px;height:22px;background:var(--red);color:var(--white);
            border-radius:50%;display:flex;align-items:center;justify-content:center;
            font-size:.78rem;font-weight:700;
        }
        .card-icon{font-size:2.4rem;margin-bottom:.8rem;display:block;}
        .card.sel .card-icon{filter:brightness(0) invert(1);}
        .card-title{font-size:1.05rem;font-weight:600;margin-bottom:.3rem;}
        .card-desc{font-size:.88rem;opacity:.75;line-height:1.5;}
        .card.sel .card-desc{opacity:.85;}

        /* ‚îÄ‚îÄ‚îÄ TAGS ‚îÄ‚îÄ‚îÄ */
        .tags-wrap{display:flex;flex-wrap:wrap;gap:.75rem;margin-bottom:2rem;}
        .tag{
            padding:.6rem 1.3rem;background:var(--gray-100);
            border:2px solid var(--gray-300);border-radius:50px;
            cursor:pointer;transition:all .3s;font-weight:500;font-size:.9rem;
        }
        .tag:hover{border-color:var(--black);}
        .tag.sel{background:var(--black);color:var(--white);border-color:var(--black);}

        /* ‚îÄ‚îÄ‚îÄ SLIDERS ‚îÄ‚îÄ‚îÄ */
        .slider-box{margin-bottom:2rem;}
        .slider-row{display:flex;justify-content:space-between;margin-bottom:.6rem;font-weight:600;}
        .slider-val{color:var(--red);}
        .slider{width:100%;height:7px;border-radius:4px;background:var(--gray-300);outline:none;-webkit-appearance:none;appearance:none;cursor:pointer;}
        .slider::-webkit-slider-thumb{-webkit-appearance:none;width:22px;height:22px;border-radius:50%;background:var(--red);cursor:pointer;transition:transform .2s;}
        .slider::-webkit-slider-thumb:hover{transform:scale(1.25);}
        .slider::-moz-range-thumb{width:22px;height:22px;border-radius:50%;background:var(--red);border:none;cursor:pointer;}

        /* ‚îÄ‚îÄ‚îÄ INPUTS ‚îÄ‚îÄ‚îÄ */
        .inp-group{margin-bottom:1.5rem;}
        .inp-label{display:block;font-weight:600;margin-bottom:.4rem;}
        .inp{
            width:100%;padding:.9rem 1rem;border:2px solid var(--gray-300);
            border-radius:10px;font-size:1rem;font-family:var(--font);
            transition:border-color .3s;
        }
        .inp:focus{outline:none;border-color:var(--black);}

        /* ‚îÄ‚îÄ‚îÄ NAV ‚îÄ‚îÄ‚îÄ */
        .nav-row{display:flex;justify-content:space-between;gap:1rem;margin-top:2.5rem;}

        /* ‚îÄ‚îÄ‚îÄ RESULTS ‚îÄ‚îÄ‚îÄ */
        #results{display:none;}
        #results.show{display:block;animation:fadeUp .5s ease;}

        .r-header{
            background:var(--gray-100);border:1px solid var(--gray-300);
            border-radius:12px;padding:2.5rem;text-align:center;margin-bottom:1.5rem;
        }
        .r-name{font-size:2.2rem;font-weight:600;margin-bottom:.5rem;}
        .r-desc{font-size:1rem;color:var(--gray-500);max-width:650px;margin:0 auto;line-height:1.7;}

        .cost-block{
            background:var(--black);color:var(--white);border-radius:12px;
            padding:2rem;text-align:center;margin-bottom:1.5rem;
        }
        .cost-small{font-size:.8rem;text-transform:uppercase;letter-spacing:.1em;opacity:.6;margin-bottom:.5rem;}
        .cost-big{font-size:3rem;font-weight:600;color:var(--red);}
        .cost-info{font-size:.9rem;opacity:.75;margin-top:.5rem;}
        .cost-grid{
            display:grid;grid-template-columns:repeat(3,1fr);gap:1rem;
            margin-top:1.5rem;padding-top:1.5rem;
            border-top:1px solid rgba(255,255,255,.15);
        }
        .cost-cell-label{font-size:.78rem;opacity:.6;margin-bottom:.3rem;}
        .cost-cell-val{font-size:1.3rem;font-weight:600;}

        .block{
            background:var(--gray-100);border:1px solid var(--gray-300);
            border-radius:12px;padding:1.8rem;margin-bottom:1.5rem;
        }
        .block-title{font-size:1.3rem;font-weight:600;margin-bottom:1.5rem;text-align:center;}

        /* pyramid */
        .pyr-section{margin-bottom:1.2rem;}
        .pyr-head{display:flex;justify-content:space-between;font-weight:600;margin-bottom:.4rem;}
        .pyr-bar{height:46px;background:var(--gray-200);border-radius:8px;overflow:hidden;}
        .pyr-fill{height:100%;display:flex;align-items:center;padding-left:1rem;color:var(--white);font-weight:700;font-size:1rem;transition:width 1s ease;}
        .pyr-t{background:var(--blue);}
        .pyr-c{background:var(--amber);}
        .pyr-f{background:var(--purple);}

        /* instructions */
        .inst-step{display:flex;gap:.9rem;padding:1rem 0;border-bottom:1px solid var(--gray-300);}
        .inst-step:last-child{border-bottom:none;}
        .inst-num{
            width:30px;height:30px;background:var(--black);color:var(--white);
            border-radius:50%;display:flex;align-items:center;justify-content:center;
            font-weight:700;font-size:.85rem;flex-shrink:0;
        }

        /* ingredients */
        .ing-item{
            display:flex;justify-content:space-between;align-items:center;
            padding:1rem;margin-bottom:.6rem;background:var(--white);
            border:1px solid var(--gray-300);border-radius:8px;
            transition:all .25s;
        }
        .ing-item:hover{border-color:var(--black);transform:translateX(4px);}
        .ing-left{display:flex;align-items:center;gap:.75rem;}
        .ing-name{font-weight:600;}
        .badge{
            padding:.25rem .65rem;border-radius:10px;
            font-size:.7rem;font-weight:600;text-transform:uppercase;
        }
        .bt{background:rgba(59,130,246,.12);color:#1e40af;}
        .bc{background:rgba(245,158,11,.12);color:#92400e;}
        .bf{background:rgba(124,58,237,.12);color:#5b21b6;}
        .ing-right{display:flex;gap:1.5rem;align-items:center;}
        .ing-pct{color:var(--gray-500);font-weight:500;font-size:.9rem;}
        .ing-drops{font-weight:700;color:var(--red);}

        .info-box{
            background:#fff5f5;border-left:4px solid var(--red);
            padding:1.2rem 1.5rem;border-radius:8px;margin:1.5rem 0;
            font-size:.95rem;line-height:1.7;
        }

        .actions-row{display:flex;gap:1rem;justify-content:center;margin-top:2rem;flex-wrap:wrap;}

        @media(max-width:768px){
            #landing h1{font-size:2.4rem;}
            .step-h{font-size:1.7rem;}
            .cards-grid{grid-template-columns:1fr;}
            .cost-grid{grid-template-columns:1fr;}
            .nav-row{flex-direction:column;}
            .actions-row{flex-direction:column;}
        }
    </style>
</head>
<body>

<!-- ‚ïê‚ïê‚ïê LANDING ‚ïê‚ïê‚ïê -->
<div id="landing">
    <div class="dot" id="dot"></div>
    <h1>Parfum Studio</h1>
    <p class="land-sub">AI-Powered Fragrance Generator</p>
    <button class="btn" onclick="startApp()">Inizia la Creazione</button>
</div>

<!-- ‚ïê‚ïê‚ïê HEADER ‚ïê‚ïê‚ïê -->
<div id="header">
    <div class="hrow">
        <div class="logo" onclick="location.reload()">
            <div class="logo-dot"></div>
            Parfum Studio
        </div>
        <button class="btn btn-outline btn-sm" onclick="location.reload()">‚Ü∫ Ricomincia</button>
    </div>
</div>

<!-- ‚ïê‚ïê‚ïê APP ‚ïê‚ïê‚ïê -->
<div id="app">

    <!-- Progress -->
    <div class="progress-wrap">
        <div class="progress-steps" id="progressSteps">
            <div class="prog-line" id="progLine"></div>
            <div class="ps active" data-s="1"><div class="ps-circle">1</div><div class="ps-label">Famiglia</div></div>
            <div class="ps" data-s="2"><div class="ps-circle">2</div><div class="ps-label">Intensit√†</div></div>
            <div class="ps" data-s="3"><div class="ps-circle">3</div><div class="ps-label">Occasione</div></div>
            <div class="ps" data-s="4"><div class="ps-circle">4</div><div class="ps-label">Stile</div></div>
            <div class="ps" data-s="5"><div class="ps-circle">5</div><div class="ps-label">Dettagli</div></div>
        </div>
    </div>

    <!-- ‚îÄ‚îÄ‚îÄ STEP 1 ‚Äì FAMIGLIA ‚îÄ‚îÄ‚îÄ -->
    <div class="step on" data-step="1">
        <h2 class="step-h">Famiglia Olfattiva</h2>
        <p class="step-sub">Scegli il carattere del tuo profumo</p>
        <div class="cards-grid" id="famGrid">
            <div class="card" data-v="fresco-agrumato" onclick="pick(this,'family')">
                <span class="card-icon">üçã</span>
                <div class="card-title">Fresco & Agrumato</div>
                <p class="card-desc">Vivace, solare, energizzante. Limone, bergamotto, aranci.</p>
            </div>
            <div class="card" data-v="floreale" onclick="pick(this,'family')">
                <span class="card-icon">üå∏</span>
                <div class="card-title">Floreale & Romantico</div>
                <p class="card-desc">Rosa, gelsomino, mughetto. Eleganza femminile pura.</p>
            </div>
            <div class="card" data-v="aromatico-fougere" onclick="pick(this,'family')">
                <span class="card-icon">üåø</span>
                <div class="card-title">Aromatico & Foug√®re</div>
                <p class="card-desc">Lavanda, erbe, felce. Fresco e classico, unisex.</p>
            </div>
            <div class="card" data-v="legnoso-ambrato" onclick="pick(this,'family')">
                <span class="card-icon">üå≥</span>
                <div class="card-title">Legnoso & Ambrato</div>
                <p class="card-desc">Cedro, sandalo, ambra. Caldo, avvolgente, elegante.</p>
            </div>
            <div class="card" data-v="orientale-speziato" onclick="pick(this,'family')">
                <span class="card-icon">üî•</span>
                <div class="card-title">Orientale & Speziato</div>
                <p class="card-desc">Cannella, incenso, resine. Misterioso e sensuale.</p>
            </div>
            <div class="card" data-v="marino-fresco" onclick="pick(this,'family')">
                <span class="card-icon">üåä</span>
                <div class="card-title">Marino & Acquatico</div>
                <p class="card-desc">Ozono, sale, alghe. Pulito, moderno, fresco.</p>
            </div>
            <div class="card" data-v="chypre-verde" onclick="pick(this,'family')">
                <span class="card-icon">üçÉ</span>
                <div class="card-title">Chypre & Verde</div>
                <p class="card-desc">Muschio di quercia, patchouly, foglie verdi. Sofisticato.</p>
            </div>
            <div class="card" data-v="gourmand-dolce" onclick="pick(this,'family')">
                <span class="card-icon">üç∞</span>
                <div class="card-title">Gourmand & Dolce</div>
                <p class="card-desc">Vaniglia, cumarina, caramello. Goloso e avvolgente.</p>
            </div>
        </div>
        <div class="nav-row">
            <button class="btn btn-outline" disabled>‚Üê Indietro</button>
            <button class="btn" onclick="goNext()">Continua ‚Üí</button>
        </div>
    </div>

    <!-- ‚îÄ‚îÄ‚îÄ STEP 2 ‚Äì INTENSIT√Ä ‚îÄ‚îÄ‚îÄ -->
    <div class="step" data-step="2">
        <h2 class="step-h">Intensit√† del Profumo</h2>
        <p class="step-sub">Scegli la concentrazione e la durata</p>
        <div class="cards-grid">
            <div class="card" data-v="edc" onclick="pick(this,'intensity')">
                <span class="card-icon">‚òÅÔ∏è</span>
                <div class="card-title">Eau de Cologne</div>
                <p class="card-desc">3‚Äì5% ¬∑ Durata 2‚Äì3 ore<br>Leggero e rinfrescante</p>
            </div>
            <div class="card" data-v="edt" onclick="pick(this,'intensity')">
                <span class="card-icon">üí®</span>
                <div class="card-title">Eau de Toilette</div>
                <p class="card-desc">8‚Äì12% ¬∑ Durata 4‚Äì6 ore<br>Quotidiano ed equilibrato</p>
            </div>
            <div class="card" data-v="edp" onclick="pick(this,'intensity')">
                <span class="card-icon">‚ö°</span>
                <div class="card-title">Eau de Parfum</div>
                <p class="card-desc">15‚Äì20% ¬∑ Durata 6‚Äì8 ore<br>Intenso e persistente</p>
            </div>
        </div>
        <div class="nav-row">
            <button class="btn btn-outline" onclick="goBack()">‚Üê Indietro</button>
            <button class="btn" onclick="goNext()">Continua ‚Üí</button>
        </div>
    </div>

    <!-- ‚îÄ‚îÄ‚îÄ STEP 3 ‚Äì OCCASIONE ‚îÄ‚îÄ‚îÄ -->
    <div class="step" data-step="3">
        <h2 class="step-h">Occasione d'Uso</h2>
        <p class="step-sub">Quando indosserai questo profumo? (scelta libera)</p>
        <div class="tags-wrap" id="tagWrap">
            <div class="tag" data-v="quotidiano" onclick="toggleTag(this)">Uso quotidiano</div>
            <div class="tag" data-v="sera" onclick="toggleTag(this)">Serata elegante</div>
            <div class="tag" data-v="lavoro" onclick="toggleTag(this)">Lavoro/Ufficio</div>
            <div class="tag" data-v="sport" onclick="toggleTag(this)">Sport</div>
            <div class="tag" data-v="romantico" onclick="toggleTag(this)">Appuntamento romantico</div>
            <div class="tag" data-v="inverno" onclick="toggleTag(this)">Inverno</div>
            <div class="tag" data-v="estate" onclick="toggleTag(this)">Estate</div>
            <div class="tag" data-v="primavera" onclick="toggleTag(this)">Primavera/Autunno</div>
        </div>
        <div class="nav-row">
            <button class="btn btn-outline" onclick="goBack()">‚Üê Indietro</button>
            <button class="btn" onclick="goNext()">Continua ‚Üí</button>
        </div>
    </div>

    <!-- ‚îÄ‚îÄ‚îÄ STEP 4 ‚Äì STILE ‚îÄ‚îÄ‚îÄ -->
    <div class="step" data-step="4">
        <h2 class="step-h">Personalizza lo Stile</h2>
        <p class="step-sub">Regola le caratteristiche del tuo profumo</p>

        <div class="slider-box">
            <div class="slider-row"><span>Dolcezza</span><span class="slider-val" id="vSweet">50%</span></div>
            <input type="range" class="slider" id="sSweet" min="0" max="100" value="50" oninput="updSlider('sSweet','vSweet')">
        </div>
        <div class="slider-box">
            <div class="slider-row"><span>Freschezza</span><span class="slider-val" id="vFresh">50%</span></div>
            <input type="range" class="slider" id="sFresh" min="0" max="100" value="50" oninput="updSlider('sFresh','vFresh')">
        </div>
        <div class="slider-box">
            <div class="slider-row"><span>Profondit√† / Note scure</span><span class="slider-val" id="vDepth">50%</span></div>
            <input type="range" class="slider" id="sDepth" min="0" max="100" value="50" oninput="updSlider('sDepth','vDepth')">
        </div>

        <div class="nav-row">
            <button class="btn btn-outline" onclick="goBack()">‚Üê Indietro</button>
            <button class="btn" onclick="goNext()">Continua ‚Üí</button>
        </div>
    </div>

    <!-- ‚îÄ‚îÄ‚îÄ STEP 5 ‚Äì DETTAGLI ‚îÄ‚îÄ‚îÄ -->
    <div class="step" data-step="5">
        <h2 class="step-h">Ultimi Dettagli</h2>
        <p class="step-sub">Nome e volume del profumo</p>
        <div style="max-width:500px;margin:0 auto">
            <div class="inp-group">
                <label class="inp-label">Nome del Profumo</label>
                <input type="text" class="inp" id="perfName" placeholder="Es. Notte di Cedro">
            </div>
            <div class="inp-group">
                <label class="inp-label">Volume Finale (ml)</label>
                <input type="number" class="inp" id="perfVol" value="50" min="10" max="1000">
            </div>
        </div>
        <div class="nav-row">
            <button class="btn btn-outline" onclick="goBack()">‚Üê Indietro</button>
            <button class="btn" onclick="generate()">üîÆ Genera Formula</button>
        </div>
    </div>

    <!-- ‚îÄ‚îÄ‚îÄ RESULTS ‚îÄ‚îÄ‚îÄ -->
    <div id="results">

        <div class="r-header">
            <div class="r-name" id="rName"></div>
            <p class="r-desc" id="rDesc"></p>
        </div>

        <div class="cost-block">
            <div class="cost-small">Costo Totale</div>
            <div class="cost-big" id="rCostTotal">‚Ç¨0.00</div>
            <p class="cost-info">per <span id="rVol">50</span> ml di <span id="rType">EDP</span></p>
            <div class="cost-grid">
                <div><div class="cost-cell-label">Concentrato</div><div class="cost-cell-val" id="rCostConc">‚Ç¨0.00</div></div>
                <div><div class="cost-cell-label">Diluente</div><div class="cost-cell-val" id="rCostDil">‚Ç¨0.00</div></div>
                <div><div class="cost-cell-label">N¬∞ Ingredienti</div><div class="cost-cell-val" id="rNIng">10</div></div>
            </div>
        </div>

        <div class="block">
            <div class="block-title">Piramide Olfattiva</div>
            <div class="pyr-section">
                <div class="pyr-head"><span>Note di Testa</span><span id="pT">0%</span></div>
                <div class="pyr-bar"><div class="pyr-fill pyr-t" id="pTbar" style="width:0%"></div></div>
            </div>
            <div class="pyr-section">
                <div class="pyr-head"><span>Note di Cuore</span><span id="pC">0%</span></div>
                <div class="pyr-bar"><div class="pyr-fill pyr-c" id="pCbar" style="width:0%"></div></div>
            </div>
            <div class="pyr-section">
                <div class="pyr-head"><span>Note di Fondo</span><span id="pF">0%</span></div>
                <div class="pyr-bar"><div class="pyr-fill pyr-f" id="pFbar" style="width:0%"></div></div>
            </div>
        </div>

        <div class="block">
            <div class="block-title">Istruzioni di Preparazione</div>
            <div class="inst-step"><div class="inst-num">1</div><div>Prepara una boccetta in vetro scuro da <strong><span id="iVol">50</span> ml</strong>.</div></div>
            <div class="inst-step"><div class="inst-num">2</div><div>Misura <strong><span id="iAlc">0</span> ml</strong> di alcol etilico 96¬∞.</div></div>
            <div class="inst-step"><div class="inst-num">3</div><div>Aggiungi gli ingredienti nell'ordine: <strong>note di fondo ‚Üí cuore ‚Üí testa</strong>.</div></div>
            <div class="inst-step"><div class="inst-num">4</div><div>Mescola delicatamente con bastoncino di vetro per 30 secondi.</div></div>
            <div class="inst-step"><div class="inst-num">5</div><div>Lascia maturare al buio per <strong>2‚Äì4 settimane</strong> (ottimale 6 settimane).</div></div>
            <div class="inst-step"><div class="inst-num">6</div><div>Agita gentilmente una volta a settimana durante la maturazione.</div></div>
        </div>

        <div class="block">
            <div class="block-title">Formula ‚Äî 10 Ingredienti</div>
            <div id="ingList"></div>
        </div>

        <div class="info-box">
            <strong>üìù Note sulla formula</strong><br>
            La piramide √® calibrata su <strong>25% testa ¬∑ 40% cuore ¬∑ 35% fondo</strong>, proporzioni classiche per un profumo armonico e persistente. Le gocce sono scalate al volume scelto.
        </div>

        <div class="actions-row">
            <button class="btn" onclick="saveFormula()">üíæ Salva Formula</button>
            <button class="btn btn-outline" onclick="location.reload()">‚Ü∫ Ricomincia da capo</button>
            <button class="btn btn-outline" onclick="window.print()">üñ®Ô∏è Stampa</button>
        </div>
    </div>

</div><!-- /app -->

<script>
/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   DATABASE INGREDIENTI (dal Kit Pro)
   Struttura: note, family, price (‚Ç¨/10ml), baseDrop (peso relativo)
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
const DB = [
    /* ‚îÄ‚îÄ TESTA ‚îÄ‚îÄ */
    {n:"BERGAMOTTO",       note:"testa", fam:"agrumato",  price:18, w:12, compat:["fresco-agrumato","floreale","aromatico-fougere","marino-fresco","chypre-verde"]},
    {n:"LIMONE ITALIA",    note:"testa", fam:"agrumato",  price:12, w:12, compat:["fresco-agrumato","marino-fresco","aromatico-fougere"]},
    {n:"MANDARINO GIALLO", note:"testa", fam:"agrumato",  price:15, w:10, compat:["fresco-agrumato","gourmand-dolce","floreale"]},
    {n:"AGRUMEX",          note:"testa", fam:"agrumato",  price:10, w:10, compat:["fresco-agrumato","marino-fresco","aromatico-fougere"]},
    {n:"VERTOCITRAL C",    note:"testa", fam:"agrumato",  price:13, w: 8, compat:["fresco-agrumato","marino-fresco"]},
    {n:"ACETATO LINALILE", note:"testa", fam:"floreale",  price:11, w:12, compat:["floreale","fresco-agrumato","aromatico-fougere"]},
    {n:"LINALOLO",         note:"testa", fam:"floreale",  price:10, w:12, compat:["floreale","fresco-agrumato","aromatico-fougere","chypre-verde"]},
    {n:"ETIL LINALOLO",    note:"testa", fam:"floreale",  price: 8, w:10, compat:["floreale","aromatico-fougere"]},
    {n:"ISORALDEINA",      note:"testa", fam:"fresco",    price:11, w: 8, compat:["marino-fresco","fresco-agrumato","chypre-verde"]},
    {n:"DIIDROMIRCENOLO",  note:"testa", fam:"fresco",    price: 9, w:10, compat:["fresco-agrumato","marino-fresco","aromatico-fougere"]},
    {n:"CARDAMOMO",        note:"testa", fam:"speziato",  price:20, w: 6, compat:["orientale-speziato","aromatico-fougere","legnoso-ambrato"]},
    {n:"PEPE NERO",        note:"testa", fam:"speziato",  price:16, w: 4, compat:["orientale-speziato","legnoso-ambrato","chypre-verde"]},
    {n:"MANZANATE",        note:"testa", fam:"fruttato",  price:16, w: 3, compat:["fresco-agrumato","gourmand-dolce","floreale"]},
    {n:"ALLIL AMIL GLICOLATE",note:"testa",fam:"fruttato",price:14,w: 3, compat:["fresco-agrumato","gourmand-dolce"]},
    {n:"ACETATO EXILE",    note:"testa", fam:"fruttato",  price: 7, w: 8, compat:["fresco-agrumato","floreale","gourmand-dolce"]},

    /* ‚îÄ‚îÄ CUORE ‚îÄ‚îÄ */
    {n:"HEDIONE",          note:"cuore", fam:"floreale",  price:25, w:15, compat:["floreale","fresco-agrumato","aromatico-fougere","marino-fresco","chypre-verde"]},
    {n:"DAMASCENONE",      note:"cuore", fam:"floreale",  price:55, w: 1, compat:["floreale","orientale-speziato","gourmand-dolce","chypre-verde"]},
    {n:"ALFA DAMASCONE",   note:"cuore", fam:"floreale",  price:45, w: 2, compat:["floreale","orientale-speziato","chypre-verde"]},
    {n:"GERANIOLO",        note:"cuore", fam:"floreale",  price:12, w:10, compat:["floreale","chypre-verde","aromatico-fougere"]},
    {n:"ACETATO BENZILE",  note:"cuore", fam:"floreale",  price: 8, w:10, compat:["floreale","aromatico-fougere"]},
    {n:"IDROSSICITRONELLALE",note:"cuore",fam:"floreale", price: 9, w:12, compat:["floreale","fresco-agrumato","chypre-verde"]},
    {n:"SALICILATO BENZILE",note:"cuore",fam:"floreale",  price: 7, w:12, compat:["floreale","chypre-verde","aromatico-fougere"]},
    {n:"ACETATO GERANILE", note:"cuore", fam:"floreale",  price: 9, w:10, compat:["floreale","chypre-verde"]},
    {n:"ALDEIDE ALFA EXILCINNAMICA",note:"cuore",fam:"floreale",price:15,w:5,compat:["floreale","orientale-speziato"]},
    {n:"ANTRANILATO METILE",note:"cuore",fam:"floreale",  price: 8, w: 8, compat:["floreale","gourmand-dolce"]},
    {n:"LAVANDINO GROSSO", note:"cuore", fam:"aromatico", price:12, w:12, compat:["aromatico-fougere","fresco-agrumato","legnoso-ambrato","chypre-verde"]},
    {n:"SALVIA SCLAREA",   note:"cuore", fam:"aromatico", price:14, w:10, compat:["aromatico-fougere","legnoso-ambrato","orientale-speziato"]},
    {n:"HELIONAL",         note:"cuore", fam:"marino",    price:22, w:10, compat:["marino-fresco","fresco-agrumato"]},
    {n:"ALDEIDE C14",      note:"cuore", fam:"fresco",    price:12, w: 6, compat:["marino-fresco","fresco-agrumato","chypre-verde"]},
    {n:"OCTINE CARBONATO METILE",note:"cuore",fam:"verde",price:12,w: 8, compat:["chypre-verde","floreale","aromatico-fougere"]},
    {n:"CANNELLA CINA",    note:"cuore", fam:"speziato",  price:25, w: 2, compat:["orientale-speziato","gourmand-dolce"]},
    {n:"NOCE MOSCATA",     note:"cuore", fam:"speziato",  price:14, w: 5, compat:["orientale-speziato","legnoso-ambrato","gourmand-dolce"]},
    {n:"EUGENOLO PURO",    note:"cuore", fam:"speziato",  price:10, w: 4, compat:["orientale-speziato","chypre-verde"]},

    /* ‚îÄ‚îÄ FONDO ‚îÄ‚îÄ */
    {n:"ISO E SUPER",      note:"fondo", fam:"legnoso",   price:18, w:15, compat:["legnoso-ambrato","orientale-speziato","marino-fresco","aromatico-fougere","chypre-verde","floreale"]},
    {n:"CEDRO VIRGINIA",   note:"fondo", fam:"legnoso",   price:16, w:10, compat:["legnoso-ambrato","orientale-speziato","aromatico-fougere","chypre-verde"]},
    {n:"PATCHOULY",        note:"fondo", fam:"legnoso",   price:20, w: 8, compat:["legnoso-ambrato","orientale-speziato","chypre-verde","gourmand-dolce"]},
    {n:"VETIVER GIAVA",    note:"fondo", fam:"legnoso",   price:22, w:10, compat:["legnoso-ambrato","fresco-agrumato","chypre-verde","aromatico-fougere"]},
    {n:"SANDALORE",        note:"fondo", fam:"legnoso",   price:24, w:10, compat:["legnoso-ambrato","floreale","orientale-speziato","gourmand-dolce"]},
    {n:"VERTOFIX COEUR",   note:"fondo", fam:"legnoso",   price:20, w:10, compat:["legnoso-ambrato","chypre-verde","aromatico-fougere"]},
    {n:"MOUSSE DE METRE",  note:"fondo", fam:"legnoso",   price:28, w: 5, compat:["chypre-verde","aromatico-fougere","legnoso-ambrato"]},
    {n:"AMBROX SUPER",     note:"fondo", fam:"ambrato",   price:35, w: 6, compat:["legnoso-ambrato","orientale-speziato","floreale","gourmand-dolce"]},
    {n:"ALDEIDE C18",      note:"fondo", fam:"orientale", price:10, w: 4, compat:["orientale-speziato","gourmand-dolce","legnoso-ambrato"]},
    {n:"CUMARINA",         note:"fondo", fam:"dolce",     price:10, w: 8, compat:["gourmand-dolce","orientale-speziato","aromatico-fougere"]},
    {n:"VANILLA",          note:"fondo", fam:"dolce",     price:12, w: 5, compat:["gourmand-dolce","orientale-speziato","floreale"]},
    {n:"GALAXOLIDE",       note:"fondo", fam:"muschiato", price:16, w:10, compat:["floreale","legnoso-ambrato","marino-fresco","aromatico-fougere","chypre-verde"]},
    {n:"HABANOLIDE",       note:"fondo", fam:"muschiato", price:25, w: 6, compat:["floreale","legnoso-ambrato","gourmand-dolce"]},
    {n:"ETILENE BRASSILATE",note:"fondo",fam:"muschiato", price:18, w: 8, compat:["floreale","marino-fresco","chypre-verde","aromatico-fougere"]},
    {n:"INCENSO PURO",     note:"fondo", fam:"resinoso",  price:30, w: 5, compat:["orientale-speziato","legnoso-ambrato","chypre-verde"]},
    {n:"MIRRA",            note:"fondo", fam:"resinoso",  price:22, w: 6, compat:["orientale-speziato","legnoso-ambrato"]},
    {n:"BENZOATO BENZILE", note:"fondo", fam:"balsamico", price: 7, w: 8, compat:["floreale","orientale-speziato","gourmand-dolce"]},
];

const CONC = {edc:5, edt:10, edp:17};
const DROP_ML = 0.05;
const ALC_COST = 0.015;

/* ‚îÄ‚îÄ TARGET PIRAMIDE (%) ‚îÄ‚îÄ */
const PYR_TARGET = {testa:25, cuore:40, fondo:35};

/* ‚îÄ‚îÄ DESCRIZIONI ‚îÄ‚îÄ */
const DESCS = {
    "fresco-agrumato":    "Vivace e solare, costruito su agrumi brillanti che aprono il cuore a note fresche e aromatiche, ancorate a una base legnosa leggera.",
    "floreale":           "Un bouquet romantico di fiori, con un cuore floreale dominante sostenuto da una testa luminosa e un fondo muschiato che ne prolunga la scia.",
    "aromatico-fougere":  "Classico e unisex: lavanda e note erbacee guidano un cuore aromatico fresco, chiuso da un fondo legnoso e muschiato di grande eleganza.",
    "legnoso-ambrato":    "Caldo e avvolgente, con una testa ariosa che lascia spazio a un cuore speziato-aromatico, sostenuto da un fondo ambrato profondo.",
    "orientale-speziato": "Misterioso e sensuale: spezie esotiche al centro, aperto da una testa piccante e chiuso da resine e ambra che rimangono sulla pelle per ore.",
    "marino-fresco":      "Pulito e moderno, ispirato alla brezza del mare: note ozoniche e acquatiche guidano un profumo leggero e contemporaneo.",
    "chypre-verde":       "Sofisticato e botanico: muschio di quercia, patchouly e note verdi creano un profumo di grande personalit√†, senza tempo.",
    "gourmand-dolce":     "Avvolgente e confortante, con vaniglia e cumarina al centro, bilanciato da una testa fruttata e un fondo cremoso-legnoso.",
};

/* ‚ïê‚ïê STATE ‚ïê‚ïê */
let step = 1;
const sel = {family:null, intensity:null, occasions:[], sweetness:50, freshness:50, depth:50};

/* ‚ïê‚ïê UI ‚ïê‚ïê */
function startApp(){
    const d = document.getElementById('dot');
    d.classList.add('boom');
    setTimeout(()=>{ document.getElementById('landing').classList.add('out'); },350);
    setTimeout(()=>{
        document.getElementById('landing').style.display='none';
        document.getElementById('header').style.display='block';
        document.getElementById('app').classList.add('show');
        updProgress();
    },900);
}

function pick(el, key){
    el.closest('.cards-grid').querySelectorAll('.card').forEach(c=>c.classList.remove('sel'));
    el.classList.add('sel');
    sel[key] = el.dataset.v;
}

function toggleTag(el){
    el.classList.toggle('sel');
    const v = el.dataset.v;
    const i = sel.occasions.indexOf(v);
    if(i>-1) sel.occasions.splice(i,1); else sel.occasions.push(v);
}

function updSlider(sid,vid){
    const val = document.getElementById(sid).value;
    document.getElementById(vid).textContent = val + '%';
    if(sid==='sSweet') sel.sweetness = +val;
    if(sid==='sFresh') sel.freshness = +val;
    if(sid==='sDepth') sel.depth     = +val;
}

function goNext(){
    if(step===1 && !sel.family){alert('Seleziona una famiglia olfattiva!');return;}
    if(step===2 && !sel.intensity){alert('Seleziona l\'intensit√†!');return;}
    document.querySelector(`.step[data-step="${step}"]`).classList.remove('on');
    document.querySelector(`.ps[data-s="${step}"]`).classList.replace('active','done');
    step++;
    document.querySelector(`.step[data-step="${step}"]`).classList.add('on');
    document.querySelector(`.ps[data-s="${step}"]`).classList.add('active');
    updProgress();
    window.scrollTo({top:0,behavior:'smooth'});
}

function goBack(){
    document.querySelector(`.step[data-step="${step}"]`).classList.remove('on');
    document.querySelector(`.ps[data-s="${step}"]`).classList.remove('active');
    step--;
    document.querySelector(`.step[data-step="${step}"]`).classList.add('on');
    document.querySelector(`.ps[data-s="${step}"]`).classList.remove('done');
    document.querySelector(`.ps[data-s="${step}"]`).classList.add('active');
    updProgress();
    window.scrollTo({top:0,behavior:'smooth'});
}

function updProgress(){
    const pct = ((step-1)/4)*100;
    document.getElementById('progLine').style.width = pct+'%';
}

/* ‚ïê‚ïê FORMULA GENERATION ‚ïê‚ïê */
function generate(){
    const vol   = parseInt(document.getElementById('perfVol').value)||50;
    const name  = document.getElementById('perfName').value || 'Il Mio Profumo';
    const fam   = sel.family;
    const conc  = CONC[sel.intensity];

    /* 1. Pool ingredienti compatibili, per nota */
    const pool = note => DB.filter(x=>x.note===note && x.compat.includes(fam));

    /* 2. Scegli esattamente 3 testa, 4 cuore, 3 fondo
          Ordina per compatibilit√† col flavour (sweet/fresh/depth) */
    function sortByStyle(arr){
        return [...arr].sort((a,b)=>{
            let sa=0, sb=0;
            if(sel.sweetness>60 && (a.fam==='dolce'||a.fam==='fruttato')) sa+=2;
            if(sel.sweetness>60 && (b.fam==='dolce'||b.fam==='fruttato')) sb+=2;
            if(sel.freshness>60 && (a.fam==='agrumato'||a.fam==='fresco'||a.fam==='marino')) sa+=2;
            if(sel.freshness>60 && (b.fam==='agrumato'||b.fam==='fresco'||b.fam==='marino')) sb+=2;
            if(sel.depth>60    && (a.fam==='resinoso'||a.fam==='ambrato'||a.fam==='legnoso'||a.fam==='orientale')) sa+=2;
            if(sel.depth>60    && (b.fam==='resinoso'||b.fam==='ambrato'||b.fam==='legnoso'||b.fam==='orientale')) sb+=2;
            return sb-sa;
        });
    }

    const picked = [
        ...sortByStyle(pool('testa')).slice(0,3),
        ...sortByStyle(pool('cuore')).slice(0,4),
        ...sortByStyle(pool('fondo')).slice(0,3),
    ];

    /* 3. Calcola ml concentrato necessario */
    const concMl = vol * conc / 100;
    const alcMl  = vol - concMl;
    const totalDropsTarget = concMl / DROP_ML;

    /* 4. Distribuisci gocce rispettando PYR_TARGET
          Ogni nota ha le sue gocce proporzionali al peso (w) normalizzato nel gruppo */
    function assignDrops(group, pctTarget){
        const gropDropsTotal = totalDropsTarget * pctTarget / 100;
        const wSum = group.reduce((s,x)=>s+x.w,0);
        return group.map(x=>({
            ...x,
            drops: Math.max(1, Math.round(x.w / wSum * gropDropsTotal))
        }));
    }

    const testa = assignDrops(picked.filter(x=>x.note==='testa'), PYR_TARGET.testa);
    const cuore = assignDrops(picked.filter(x=>x.note==='cuore'), PYR_TARGET.cuore);
    const fondo = assignDrops(picked.filter(x=>x.note==='fondo'), PYR_TARGET.fondo);
    const formula = [...testa,...cuore,...fondo];

    /* 5. Totali reali */
    const totalDrops = formula.reduce((s,x)=>s+x.drops,0);
    const realPyr = {
        testa: (testa.reduce((s,x)=>s+x.drops,0)/totalDrops*100).toFixed(1),
        cuore: (cuore.reduce((s,x)=>s+x.drops,0)/totalDrops*100).toFixed(1),
        fondo: (fondo.reduce((s,x)=>s+x.drops,0)/totalDrops*100).toFixed(1),
    };

    /* 6. Costi */
    const concCost = formula.reduce((s,x)=> s + (x.price/10)*(x.drops*DROP_ML), 0);
    const dilCost  = alcMl * ALC_COST;
    const totCost  = concCost + dilCost;

    renderResults({name,vol,conc,alcMl,formula,realPyr,totCost,concCost,dilCost,totalDrops});
}

function renderResults(d){
    document.getElementById('wizardContainer') && (document.getElementById('wizardContainer').style.display='none');
    /* hide wizard steps */
    document.querySelectorAll('.step').forEach(s=>s.classList.remove('on'));
    document.querySelector('.progress-wrap').style.display='none';

    const R = document.getElementById('results');
    R.classList.add('show');

    const typeLabel = {edc:'EDC ‚Äì Eau de Cologne',edt:'EDT ‚Äì Eau de Toilette',edp:'EDP ‚Äì Eau de Parfum'};
    document.getElementById('rName').textContent     = d.name;
    document.getElementById('rDesc').textContent     = DESCS[sel.family];
    document.getElementById('rVol').textContent      = d.vol;
    document.getElementById('rType').textContent     = typeLabel[sel.intensity];
    document.getElementById('rCostTotal').textContent= '‚Ç¨'+d.totCost.toFixed(2);
    document.getElementById('rCostConc').textContent = '‚Ç¨'+d.concCost.toFixed(2);
    document.getElementById('rCostDil').textContent  = '‚Ç¨'+d.dilCost.toFixed(2);
    document.getElementById('rNIng').textContent     = d.formula.length;
    document.getElementById('iVol').textContent      = d.vol;
    document.getElementById('iAlc').textContent      = d.alcMl.toFixed(1);

    /* pyramid animated */
    setTimeout(()=>{
        ['T','C','F'].forEach(k=>{
            const pct = k==='T'?d.realPyr.testa:k==='C'?d.realPyr.cuore:d.realPyr.fondo;
            document.getElementById('p'+k).textContent     = pct+'%';
            document.getElementById('p'+k+'bar').style.width= pct+'%';
            document.getElementById('p'+k+'bar').textContent= pct+'%';
        });
    },300);

    const list = document.getElementById('ingList');
    list.innerHTML = d.formula.map(x=>`
        <div class="ing-item">
            <div class="ing-left">
                <div class="ing-name">${x.n}</div>
                <span class="badge b${x.note[0]}">${x.note}</span>
            </div>
            <div class="ing-right">
                <span class="ing-pct">${(x.drops/d.totalDrops*100).toFixed(1)}%</span>
                <span class="ing-drops">${x.drops} gocce</span>
            </div>
        </div>`).join('');

    window.scrollTo({top:0,behavior:'smooth'});
}

function saveFormula(){
    const saved = JSON.parse(localStorage.getItem('parfum_formulas')||'[]');
    saved.push({
        name: document.getElementById('rName').textContent,
        family: sel.family,
        intensity: sel.intensity,
        date: new Date().toISOString()
    });
    localStorage.setItem('parfum_formulas', JSON.stringify(saved));
    alert('Formula salvata!');
}
</script>
</body>
</html>
